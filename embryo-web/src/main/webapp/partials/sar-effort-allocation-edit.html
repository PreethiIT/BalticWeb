<div x-ng-controller="SarEffortAllocationController">

    <div e-reporting-panel x-ng-if="provider.doShow" id="sarEffortAllocationEditPanel">
        <h2>
            <a class="close" href="#" style="float: right" x-ng-click="close($event)">&times;</a>Effort Allocation
        </h2>

        <div>
            <div x-ng-if="page == 'SRU'">
                <h5>Search and rescue units (SRUs)</h5>

                <table class="table table-condensed srus">
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Search speed</th>
                        <th>Fatigue</th>
                        <th>Effort Allocation</th>
                        <th>Search Pattern</th>
                        <th></th>
                    </tr>
                    <tr x-ng-repeat="SRU in srus track by $index">
                        <td><a href="#" x-ng-click="editSRU($event, SRU)">{{SRU.name}}</a></td>
                        <td>{{typeText[SRU.type]}}</td>
                        <td>{{SRU.speed}} knots</td>
                        <td>{{SRU.fatigue}}</td>
                        <td>
                            <button class="btn btn-sm" x-ng-if="SRU.status == AllocationStatus.DraftSRU"
                                    x-ng-click="toZoneCalculation(SRU)">Calculate zone
                            </button>
                            <button class="btn btn-sm btn-success" x-ng-if="SRU.status == AllocationStatus.DraftZone"
                                    x-ng-click="confirmActivation(SRU)">Activate zone
                            </button>
                            <span x-ng-if="SRU.status == AllocationStatus.Active">Active</span>

                        </td>
                        <td>
                            <button class="btn btn-sm" x-ng-if="SRU.status !== AllocationStatus.DraftSRU" x-ng-click="">
                                Generate
                            </button>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-danger" x-ng-click="toConfirmDelSRU($event, SRU)">Remove
                            </button>
                        </td>
                    </tr>
                </table>
                <div class="col-xs-12">
                    <span class="pull-right">
                        <button type="button" class="btn btn-primary btn-sm" x-ng-click="newUnit()">Add new SRU</button>
                        <button type="button" class="btn btn-primary btn-sm" x-ng-click="provider.close()">Close
                        </button>
                    </span>
                </div>

            </div>
            <div x-ng-if="page == 'editUnit'">
                <h4>Manage SRU</h4>

                <form name="SRUForm" class="form-horizontal" novalidate>
                    <hr/>
                    <div x-ng-show="alertMessages" class="alert alert-danger">
                        <span x-ng-repeat="msg in alertMessages">{{msg}}<br/></span>
                    </div>
                    <div x-ng-show="message" class="alert alert-info">{{message}}</div>

                    <h5>SRU Information</h5>

                    <div class="form-group">
                        <label class="control-label col-xs-3">Participant:</label>

                        <div class="col-xs-8">
                            <input x-ng-model="sru.name" type="text"
                                   class="form-control input-sm" placeholder="Name" required/>
                        </div>

                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3">Type:</label>

                        <div class="col-xs-8">
                            <select ng-model="sru.type" name="type" required
                                    class="input-sm form-control"
                                    x-ng-options="type as typeText[type] for type in vesselTypes">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3">Search Velocity:</label>

                        <div class="col-xs-3">
                            <input x-ng-model="sru.speed" type="text"
                                   class="form-control input-sm" placeholder="5 knots" required/>
                        </div>
                        <div class="col-xs-3 unit">
                            <span>knots</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-3">Fatigue:</label>

                        <div class="col-xs-3">
                            <select ng-model="sru.fatigue" name="fatigue"
                                    class="input-sm form-control"
                                    x-ng-options="fatigue for fatigue in fatigues">
                            </select>
                        </div>
                    </div>

                    <h5>SAR Information</h5>

                    <div class="form-group">
                        <label class="control-label col-xs-3">On scene time:</label>

                        <div class="col-xs-3">
                            <input x-ng-model="sru.time" type="text"
                                   class="form-control input-sm" placeholder="5" required/>
                        </div>
                        <div class="col-xs-3 unit">
                            hours
                        </div>
                    </div>

                    <div class="col-xs-12">
                        <span class="pull-right">
                            <button type="button" class="btn btn-sm" x-ng-click="toSrus()">Cancel</button> &nbsp;
                            <button type="button" class="btn btn-primary btn-sm" x-ng-click="saveUnit()"
                                    x-ng-disabled="SRUForm.$invalid || !sru">Save
                            </button>
                        </span>
                    </div>

                </form>
            </div>

            <form x-ng-if="page == 'deleteSRU'" name="deleteSruForm" class="form-horizontal" novalidate>
                <hr/>
                <div x-ng-show="alertMessages" class="alert alert-danger">
                    <span x-ng-repeat="msg in alertMessages">{{msg}}<br/></span>
                </div>
                <div x-ng-show="message" class="alert alert-info">{{message}}</div>


                <div class="col-xs-12">
                    Remove search and rescue unit <strong>{{sru.name}}</strong>?
                </div>
                <div class="col-xs-12">
                    <span class="pull-right">
                        <button type="button" class="btn btn-sm" x-ng-click="toSrus()">Cancel</button> &nbsp;
                        <button type="button" class="btn btn-primary btn-sm" x-ng-click="removeSRU(sru)">Remove</button>
                    </span>
                </div>

            </form>
            <form x-ng-if="page == 'effort'" name="effortAllocationForm" class="form-horizontal" novalidate>
                <hr/>
                <div x-ng-show="alertMessages" class="alert alert-danger">
                    <span x-ng-repeat="msg in alertMessages">{{msg}}<br/></span>
                </div>
                <div x-ng-show="message" class="alert alert-info">{{message}}</div>

                <h5>SAR Information</h5>

                <div class="form-group">
                    <label class="control-label col-xs-3">Target type:</label>

                    <div class="col-xs-6">
                        <select ng-model="effort.target" name="type" required
                                class="input-sm form-control"
                                x-ng-options="type as targetText[type] for type in targetTypes">
                        </select>
                    </div>
                </div>

                <h5>Weather information</h5>

                <div class="form-group">
                    <label class="control-label col-xs-3">Wind speed:</label>

                    <div class="col-xs-2">
                        <input x-ng-model="effort.wind" type="text"
                               class="form-control input-sm" required/>
                    </div>
                    <div class="col-xs-1 unit">
                        knots
                    </div>
                    <label class="control-label col-xs-3">Visibility:</label>
                    <div class="col-xs-2">
                        <select ng-model="effort.visibility" name="visibility" required
                                class="input-sm form-control"
                                x-ng-options="visibility for visibility in visibilityValues">
                        </select>
                    </div>
                    <div class="col-xs-1 unit">
                        nm
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-xs-3">Water elevation:</label>

                    <div class="col-xs-2">
                        <input x-ng-model="effort.waterElevation" type="text"
                               class="form-control input-sm" required/>
                    </div>
                    <div class="col-xs-2 unit">
                        feet
                    </div>
                </div>
                <h5>Additional options</h5>

                <div class="form-group">
                    <label class="control-label col-xs-6">Desired Probability of Detection:</label>
                    <div class="col-xs-2">
                        <input x-ng-model="effort.pod" type="number"
                               class="form-control input-sm" required/>
                    </div>
                    <div class="col-xs-1 unit">
                        %
                    </div>
                </div>
                <!--
                <div class="form-group">
                    <label class="control-label col-xs-6">TODO warning if POD below 60%:</label>
                </div>-->
                <div class="col-xs-12">
                    <span class="pull-right">
                        <button type="button" class="btn btn-sm" x-ng-click="toSrus()">Back</button> &nbsp;
                        <button type="button" class="btn btn-primary btn-sm" x-ng-click="calculate()"
                                x-ng-disabled="effortAllocationForm.$invalid">Calculate Effective
                            Area
                        </button>
                    </span>
                </div>
            </form>
            <form x-ng-if="page == 'activate'" name="activateForm" class="form-horizontal" novalidate>
                <hr/>
                <div x-ng-show="alertMessages" class="alert alert-danger">
                    <span x-ng-repeat="msg in alertMessages">{{msg}}<br/></span>
                </div>
                <div x-ng-show="message" class="alert alert-info">{{message}}</div>


                <div class="row">
                    <div class="col-xs-12">
                        <p>
                            Do you want to activate effort allocation zone for <strong>{{effort.name}}</strong>? <br/>
                            The effort allocation zone will hereby be shared with other SRUs as well as other relevant
                            parties.
                        </p>

                        <p x-ng-if="effAllExists">
                            The existing effort allocation for {{effort.name}} will be replaced by your new effort
                            allocation.
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                    <span class="pull-right">
                        <button type="button" class="btn btn-sm" x-ng-click="provider.close()">Cancel</button> &nbsp;
                        <button type="button" class="btn btn-primary btn-sm" x-ng-click="activate(effort)">Activate
                        </button>
                    </span>
                    </div>
                </div>
            </form>
        </div>

    </div>
</div>